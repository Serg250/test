"use strict";class MyRating{constructor(t,e,n){this.rating=e,this.element=document.getElementById(t),this.outHtml(),this.taboo=n,this.setRating(this.rating),this.taboo?this.element.classList.add("on"):this.element.classList.add("off"),this.createEvent(this.element)}getRating(){return this.rating}setRating(t=this.rating){t<1&&(t=1),t>5&&(t=5);let e=5;this.el=document.getElementsByClassName("star");for(let n of this.el)e==t&&(n.checked=!0),e--;return this.rating=t}newRating(t){if(this.taboo){let e=5;this.el=document.getElementsByClassName("star");for(let n of this.el)e==t&&(n.checked=!0),e--;return this.element.classList.remove("on"),this.element.classList.add("off"),this.createEvent(this.element),this.taboo=!1,this.rating=t}return!1}outHtml(){let t="",e=5;for(;e>0;)t=t+'<input class="star" type="radio" id="star-'+e+'" name="rating" value="'+e+'"><label for="star-'+e+'" title="Оценка «'+e+'»"></label>',e--;return this.element.innerHTML=t,this.setRating(),!0}createEvent(t){if(t.classList.contains("on")){t.onmouseover=function(){let e=4;for(;e>-1;)t.querySelectorAll(".star")[e].checked=!1,e--},this.element.onmouseout=function(){rating.setRating()};let e=document.querySelectorAll(".star");return[].forEach.call(e,function(t){t.onclick=function(t){return rating.setRating(1),!1}}),!1}return t.onmouseover=function(){return!1},!0}send(t,e){const n=new XMLHttpRequest,s="rat="+t+"&count="+e;n.responseType="json",n.open("POST","data_rating.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.addEventListener("readystatechange",()=>{if(4===n.readyState&&200===n.status){let t=n.response;console.log(t.all),rating.setRating(Number.parseInt(t.all)),document.getElementById("count").innerHTML=t.count,document.getElementById("rat").innerHTML=t.all}}),n.send(s)}set_cookie(){let t=new Date(Date.now()+864e6);return t=t.toUTCString(),document.cookie="rating=yes; expires="+t,!0}get_cookie(){var t=document.cookie.match("(^|;) ?rating=([^;]*)(;|$)");return t?unescape(t[2]):null}}window.onload=function(){let t=Number.parseInt(document.getElementById("rat").textContent),e=new MyRating("rating",t,!0),n=document.querySelectorAll(".star"),s=e.get_cookie();"yes"!==s?[].forEach.call(n,function(t){t.onclick=function(n){if(id=document.getElementById("rating"),id.classList.contains("on")){e.newRating(t.value),e.set_cookie();let n=Number.parseInt(document.getElementById("count").textContent);e.send(t.value,n)}return!1}}):(document.getElementById("rating").classList.remove("on"),document.getElementById("rating").classList.add("off"),e.newRating(t),s="yes")};